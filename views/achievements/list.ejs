<% title = 'Special Achievements' %>

<div class="px-4 sm:px-0">
  <h1 class="text-3xl font-bold tracking-tight text-gray-900 mb-8">Special Achievements</h1>

  <div class="space-y-4">
    <% achievements.forEach((achievement, index) => { %>
      <div class="card <%= achievement.verified ? 'ring-2 ring-green-500' : '' %>">
        <div class="card-body">
          <!-- Achievement Header - Clickable -->
          <button 
            type="button"
            data-achievement="<%= index %>"
            class="w-full text-left achievement-toggle"
          >
            <div class="flex items-start justify-between gap-4">
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                  <h3 class="text-lg font-semibold text-gray-900"><%= achievement.name %></h3>
                  <% if (achievement.verified) { %>
                    <span class="badge badge-success">✓ Verified</span>
                  <% } else { %>
                    <span class="badge badge-warning">Pending Submission</span>
                  <% } %>
                </div>
                <p class="text-sm text-gray-600"><%= achievement.description %></p>
                <% if (achievement.verified) { %>
                  <p class="mt-3 text-xs text-green-600">
                    ✓ Verified on <%= new Date(achievement.verified_at).toLocaleDateString() %>
                  </p>
                <% } %>
              </div>
              <% if (!achievement.verified) { %>
                <div class="flex-shrink-0">
                  <svg class="h-5 w-5 text-gray-400 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </div>
              <% } %>
            </div>
          </button>

          <!-- Submission Form (Collapsible) -->
          <% if (!achievement.verified) { %>
            <div id="achievement-<%= index %>" class="hidden mt-6 pt-6 border-t border-gray-200">
              <form method="POST" action="/achievements/<%= achievement.id %>/submit" enctype="multipart/form-data">
                <div class="grid gap-6 sm:grid-cols-2">
                  <% if (achievement.requires_proof) { %>
                    <div>
                      <label class="block text-sm font-medium text-gray-900" for="proof-<%= achievement.id %>">
                        Upload Proof <span class="text-red-600">*</span>
                      </label>
                      <div class="mt-2">
                        <input class="form-input" id="proof-<%= achievement.id %>" name="proof" type="file" accept=".pdf,.jpg,.jpeg,.png" required>
                      </div>
                      <p class="mt-1 text-xs text-gray-500">Accepted formats: PDF, JPG, PNG</p>
                    </div>
                  <% } %>
                  <div>
                    <label class="block text-sm font-medium text-gray-900" for="notes-<%= achievement.id %>">
                      Additional Notes
                    </label>
                    <div class="mt-2">
                      <textarea class="form-input" id="notes-<%= achievement.id %>" name="notes" rows="3" placeholder="Provide any additional context or details..."></textarea>
                    </div>
                  </div>
                </div>
                <div class="mt-6 flex justify-end">
                  <button type="submit" class="btn-primary">
                    <svg class="inline-block h-4 w-4 mr-2 -ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Submit for Review
                  </button>
                </div>
              </form>
            </div>
          <% } %>
        </div>
      </div>
    <% }); %>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.achievement-toggle').forEach(button => {
    button.addEventListener('click', function() {
      const achievementId = this.getAttribute('data-achievement');
      const form = document.getElementById('achievement-' + achievementId);
      const svg = this.querySelector('svg');
      
      if (form) {
        form.classList.toggle('hidden');
      }
      if (svg) {
        svg.classList.toggle('rotate-180');
      }
    });
  });
});
</script>
