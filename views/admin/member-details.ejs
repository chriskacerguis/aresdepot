<% title = 'Member Details - ' + member.first_name + ' ' + member.last_name %>

<div class="px-4 sm:px-0">
  <a href="/admin/members" class="text-sm font-semibold text-indigo-600 hover:text-indigo-500">← Back to Members</a>
  
  <% 
    const statusBannerConfig = {
      inactive: { 
        bg: 'bg-gray-100', 
        border: 'border-gray-200', 
        text: 'text-gray-800',
        icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />',
        title: 'Inactive Member',
        description: 'This member account is currently inactive and has no system access.'
      },
      suspended: { 
        bg: 'bg-yellow-50', 
        border: 'border-yellow-200', 
        text: 'text-yellow-800',
        icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />',
        title: 'Suspended Member',
        description: 'This member account is temporarily suspended. Access has been restricted pending review.'
      },
      banned: { 
        bg: 'bg-red-50', 
        border: 'border-red-200', 
        text: 'text-red-800',
        icon: '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />',
        title: 'Banned Member',
        description: 'This member has been permanently banned from the system. All access has been revoked.'
      }
    };
    const currentStatus = member.status || 'active';
    const banner = statusBannerConfig[currentStatus];
  %>
  
  <% if (banner) { %>
    <div class="mt-4 rounded-lg <%= banner.bg %> border <%= banner.border %> p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 <%= banner.text %>" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <%- banner.icon %>
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-semibold <%= banner.text %>"><%= banner.title %></h3>
          <p class="mt-1 text-sm <%= banner.text %>"><%= banner.description %></p>
        </div>
      </div>
    </div>
  <% } %>
  
  <div class="mt-4 mb-8">
    <div class="flex items-center gap-4">
      <% if (member.profile_photo_path) { %>
        <img src="<%= member.profile_photo_path %>" alt="<%= member.first_name %> <%= member.last_name %>" class="h-20 w-20 rounded-full object-cover border-2 border-gray-300">
      <% } else { %>
        <div class="h-20 w-20 rounded-full bg-gray-200 flex items-center justify-center">
          <svg class="h-12 w-12 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
            <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z" />
          </svg>
        </div>
      <% } %>
      <div>
        <h1 class="text-3xl font-bold tracking-tight text-gray-900">
          <%= member.first_name %> <%= member.last_name %> (<%= member.callsign %>)
        </h1>
      <% 
        const licenseConfig = {
          Technician: { bg: 'bg-slate-100', text: 'text-slate-700', ring: 'ring-slate-600/20', label: 'Technician' },
          General: { bg: 'bg-amber-100', text: 'text-amber-700', ring: 'ring-amber-600/20', label: 'General' },
          Extra: { bg: 'bg-emerald-100', text: 'text-emerald-700', ring: 'ring-emerald-600/20', label: 'Extra' }
        };
        const license = member.license_class ? licenseConfig[member.license_class] : null;
        
        // Find the highest achieved tier
        const achievedTiers = member.tiers ? member.tiers.filter(t => t.achieved) : [];
        const highestTier = achievedTiers.length > 0 ? achievedTiers[achievedTiers.length - 1] : null;
        
        const tierConfig = {
          'Level 1 - Basic': { bg: 'bg-orange-100', text: 'text-orange-700', ring: 'ring-orange-600/20' },
          'Level 2 - Intermediate': { bg: 'bg-slate-200', text: 'text-slate-700', ring: 'ring-slate-600/20' },
          'Level 3 - Advanced': { bg: 'bg-yellow-100', text: 'text-yellow-800', ring: 'ring-yellow-600/20' }
        };
        const tierStyle = highestTier ? tierConfig[highestTier.name] : null;
      %>
        <% if (license) { %>
          <span class="inline-flex items-center rounded-md <%= license.bg %> px-2.5 py-1 text-sm font-semibold <%= license.text %> ring-1 ring-inset <%= license.ring %>">
            <%= license.label %>
          </span>
        <% } %>
        <% if (highestTier && tierStyle) { %>
          <span class="inline-flex items-center rounded-md <%= tierStyle.bg %> px-2.5 py-1 text-sm font-semibold <%= tierStyle.text %> ring-1 ring-inset <%= tierStyle.ring %> ml-2">
            <%= highestTier.name %>
          </span>
        <% } %>
      </div>
    </div>
  </div>

  <!-- Member Info -->
  <div class="card mb-6">
    <div class="card-body">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold text-gray-900">Contact Information</h2>
        <button type="button" id="toggle-edit-btn" class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-indigo-600 hover:text-indigo-500">
          <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
          Edit
        </button>
      </div>
      
      <!-- View Mode -->
      <div id="contact-view" class="grid md:grid-cols-2 gap-6 text-sm">
        <div>
          <p class="text-sm font-medium text-gray-500">Email:</p>
          <p class="mt-1 text-sm text-gray-900"><%= member.email || 'N/A' %></p>
        </div>
        <div>
          <p class="text-sm font-medium text-gray-500">Phone:</p>
          <p class="mt-1 text-sm text-gray-900"><%= member.phone %></p>
        </div>
        <div>
          <p class="text-sm font-medium text-gray-500">Address:</p>
          <p class="mt-1 text-sm text-gray-900">
            <%= member.address %><br>
            <%= member.city %>, <%= member.state %> <%= member.zip %>
          </p>
        </div>
        <div>
          <p class="text-sm font-medium text-gray-500">County:</p>
          <p class="mt-1 text-sm text-gray-900"><%= member.county %></p>
        </div>
        <div class="md:col-span-2 pt-4 mt-4 border-t border-gray-200">
          <h3 class="text-sm font-semibold text-gray-900 mb-3">Admin Settings</h3>
          <div class="grid md:grid-cols-2 gap-4">
            <div>
              <p class="text-sm font-medium text-gray-500">Title:</p>
              <div class="mt-1">
                <% 
                  const memberTitle = member.title || 'Member';
                  let titleBadgeClass = '';
                  if (memberTitle === 'Emergency Coordinator') {
                    titleBadgeClass = 'bg-purple-100 text-purple-800';
                  } else if (memberTitle === 'Deputy Emergency Coordinator') {
                    titleBadgeClass = 'bg-blue-100 text-blue-800';
                  } else if (memberTitle === 'Assistant Emergency Coordinator') {
                    titleBadgeClass = 'bg-indigo-100 text-indigo-800';
                  } else {
                    titleBadgeClass = 'bg-gray-100 text-gray-800';
                  }
                %>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= titleBadgeClass %>">
                  <%= memberTitle %>
                </span>
              </div>
            </div>
            <div>
              <p class="text-sm font-medium text-gray-500">Status:</p>
              <div class="mt-1">
                <% 
                  const statusLabels = {
                    active: 'Active',
                    inactive: 'Inactive',
                    suspended: 'Suspended',
                    banned: 'Banned'
                  };
                  const statusLabel = statusLabels[member.status] || 'Active';
                  let statusBadgeClass = '';
                  if (member.status === 'active') {
                    statusBadgeClass = 'bg-green-100 text-green-800';
                  } else if (member.status === 'banned') {
                    statusBadgeClass = 'bg-red-100 text-red-800';
                  } else if (member.status === 'suspended') {
                    statusBadgeClass = 'bg-yellow-100 text-yellow-800';
                  } else {
                    statusBadgeClass = 'bg-gray-100 text-gray-800';
                  }
                %>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= statusBadgeClass %>">
                  <%= statusLabel %>
                </span>
              </div>
            </div>
            <div>
              <p class="text-sm font-medium text-gray-500">Background Check:</p>
              <div class="mt-1">
                <% 
                  const bgCheck = member.background_check || 'Not Started';
                  let badgeClass = '';
                  if (bgCheck === 'Passed') {
                    badgeClass = 'bg-green-100 text-green-800';
                  } else if (bgCheck === 'Failed') {
                    badgeClass = 'bg-red-100 text-red-800';
                  } else if (bgCheck === 'Pending') {
                    badgeClass = 'bg-yellow-100 text-yellow-800';
                  } else {
                    badgeClass = 'bg-gray-100 text-gray-800';
                  }
                %>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= badgeClass %>">
                  <%= bgCheck %>
                  <% if (member.background_check_date) { %>
                    <span class="ml-1.5 opacity-75">• <%= new Date(member.background_check_date).toLocaleDateString() %></span>
                  <% } %>
                </span>
              </div>
            </div>
            <div>
              <p class="text-sm font-medium text-gray-500">Admin Access:</p>
              <div class="mt-1 flex items-center gap-2">
                <% if (member.is_admin) { %>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                    Administrator
                  </span>
                <% } else { %>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                    Member
                  </span>
                <% } %>
                <% if (user.id !== member.user_id) { %>
                  <form method="POST" action="/admin/members/<%= member.id %>/toggle-admin" class="inline" onsubmit="return confirmAdminToggle('<%= member.first_name %> <%= member.last_name %>', <%= member.is_admin ? 'true' : 'false' %>)">
                    <button type="submit" class="text-sm font-medium <%= member.is_admin ? 'text-red-600 hover:text-red-500' : 'text-indigo-600 hover:text-indigo-500' %>">
                      <%= member.is_admin ? 'Remove Admin' : 'Make Admin' %>
                    </button>
                  </form>
                <% } %>
              </div>
            </div>
          </div>
          <div class="md:col-span-2 mt-4">
            <p class="text-sm font-medium text-gray-500">Admin Notes:</p>
            <% if (member.admin_notes) { %>
              <p class="mt-1 text-sm text-gray-900 whitespace-pre-wrap"><%= member.admin_notes %></p>
            <% } else { %>
              <p class="mt-1 text-sm text-gray-500 italic">No admin notes on file</p>
            <% } %>
          </div>
        </div>
      </div>

      <!-- Edit Mode -->
      <div id="contact-edit" class="hidden">
        <form method="POST" action="/admin/members/<%= member.id %>/update" class="space-y-6">
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-900" for="firstName">First Name *</label>
              <div class="mt-2">
                <input class="form-input" id="firstName" name="firstName" type="text" required value="<%= member.first_name %>">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-900" for="lastName">Last Name *</label>
              <div class="mt-2">
                <input class="form-input" id="lastName" name="lastName" type="text" required value="<%= member.last_name %>">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-900" for="callsign">Callsign *</label>
              <div class="mt-2">
                <input class="form-input" id="callsign" name="callsign" type="text" required value="<%= member.callsign %>">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-900" for="phone">Phone *</label>
              <div class="mt-2">
                <input class="form-input" id="phone" name="phone" type="tel" required value="<%= member.phone %>">
              </div>
            </div>
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-900" for="address">Address *</label>
              <div class="mt-2">
                <input class="form-input" id="address" name="address" type="text" required value="<%= member.address %>">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-900" for="city">City *</label>
              <div class="mt-2">
                <input class="form-input" id="city" name="city" type="text" required value="<%= member.city %>">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-900" for="state">State *</label>
              <div class="mt-2">
                <input class="form-input" id="state" name="state" type="text" required value="<%= member.state %>">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-900" for="zip">ZIP *</label>
              <div class="mt-2">
                <input class="form-input" id="zip" name="zip" type="text" required value="<%= member.zip %>">
              </div>
            </div>
            <div>
              <label class="block text="sm font-medium text-gray-900" for="county">County *</label>
              <div class="mt-2">
                <input class="form-input" id="county" name="county" type="text" required value="<%= member.county %>">
              </div>
            </div>
          </div>
          
          <div class="border-t border-gray-200 pt-6 mt-6">
            <h3 class="text-base font-semibold text-gray-900 mb-4">Admin Settings</h3>
            <div class="grid md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-gray-900" for="title">Title *</label>
                <div class="mt-2">
                  <select class="form-input" id="title" name="title" required>
                    <option value="Member" <%= (member.title || 'Member') === 'Member' ? 'selected' : '' %>>Member</option>
                    <option value="Assistant Emergency Coordinator" <%= member.title === 'Assistant Emergency Coordinator' ? 'selected' : '' %>>Assistant Emergency Coordinator</option>
                    <option value="Deputy Emergency Coordinator" <%= member.title === 'Deputy Emergency Coordinator' ? 'selected' : '' %>>Deputy Emergency Coordinator</option>
                    <option value="Emergency Coordinator" <%= member.title === 'Emergency Coordinator' ? 'selected' : '' %>>Emergency Coordinator</option>
                  </select>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-900" for="status">Status *</label>
                <div class="mt-2">
                  <select class="form-input" id="status" name="status" required>
                    <option value="active" <%= member.status === 'active' ? 'selected' : '' %>>Active</option>
                    <option value="inactive" <%= member.status === 'inactive' ? 'selected' : '' %>>Inactive</option>
                    <option value="suspended" <%= member.status === 'suspended' ? 'selected' : '' %>>Suspended</option>
                    <option value="banned" <%= member.status === 'banned' ? 'selected' : '' %>>Banned</option>
                  </select>
                </div>
                <p class="mt-1 text-xs text-gray-500">
                  Active: Full access • Inactive: No access • Suspended: Temporary restriction • Banned: Permanent restriction
                </p>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-900" for="backgroundCheck">Background Check *</label>
                <div class="mt-2">
                  <select class="form-input" id="backgroundCheck" name="backgroundCheck" required>
                    <option value="Not Started" <%= (member.background_check || 'Not Started') === 'Not Started' ? 'selected' : '' %>>Not Started</option>
                    <option value="Pending" <%= member.background_check === 'Pending' ? 'selected' : '' %>>Pending</option>
                    <option value="Passed" <%= member.background_check === 'Passed' ? 'selected' : '' %>>Passed</option>
                    <option value="Failed" <%= member.background_check === 'Failed' ? 'selected' : '' %>>Failed</option>
                  </select>
                </div>
                <% if (member.background_check_date) { %>
                  <p class="mt-1 text-xs text-gray-500">
                    Last updated: <%= new Date(member.background_check_date).toLocaleDateString() %>
                  </p>
                <% } %>
              </div>
            </div>
            <div class="md:col-span-2">
              <label class="block text-sm font-medium text-gray-900" for="adminNotes">Admin Notes</label>
              <div class="mt-2">
                <textarea class="form-input" id="adminNotes" name="adminNotes" rows="4" placeholder="Private notes visible only to administrators..."><%= member.admin_notes || '' %></textarea>
              </div>
              <p class="mt-1 text-xs text-gray-500">
                These notes are only visible to administrators and will not be shown to the member.
              </p>
            </div>
          </div>
          <div class="flex gap-3 pt-4">
            <button type="submit" class="btn-primary">Save Changes</button>
            <button type="button" id="cancel-edit-btn" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Emergency Contact -->
  <div class="card mb-6">
    <div class="card-body">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold text-gray-900">Emergency Contact</h2>
        <button type="button" id="toggle-emergency-btn" class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-indigo-600 hover:text-indigo-500">
          <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
          Edit
        </button>
      </div>
      
      <!-- View Mode -->
      <div id="emergency-view">
        <% if (member.emergency_contact_name) { %>
          <div class="grid md:grid-cols-2 gap-6 text-sm">
            <div>
              <p class="text-sm font-medium text-gray-500">Name:</p>
              <p class="mt-1 text-sm text-gray-900"><%= member.emergency_contact_name %></p>
            </div>
            <div>
              <p class="text-sm font-medium text-gray-500">Relationship:</p>
              <p class="mt-1 text-sm text-gray-900"><%= member.emergency_contact_relationship || 'N/A' %></p>
            </div>
            <div>
              <p class="text-sm font-medium text-gray-500">Phone:</p>
              <p class="mt-1 text-sm text-gray-900"><%= member.emergency_contact_phone || 'N/A' %></p>
            </div>
            <div>
              <p class="text-sm font-medium text-gray-500">Email:</p>
              <p class="mt-1 text-sm text-gray-900"><%= member.emergency_contact_email || 'N/A' %></p>
            </div>
          </div>
        <% } else { %>
          <p class="text-sm text-gray-500 italic">No emergency contact information on file</p>
        <% } %>
      </div>

      <!-- Edit Mode -->
      <div id="emergency-edit" class="hidden">
        <form method="POST" action="/admin/members/<%= member.id %>/update" class="space-y-6">
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-900" for="emergencyContactName">Contact Name</label>
              <div class="mt-2">
                <input class="form-input" id="emergencyContactName" name="emergencyContactName" type="text" value="<%= member.emergency_contact_name || '' %>">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-900" for="emergencyContactRelationship">Relationship</label>
              <div class="mt-2">
                <input class="form-input" id="emergencyContactRelationship" name="emergencyContactRelationship" type="text" placeholder="e.g., Spouse, Parent, Sibling" value="<%= member.emergency_contact_relationship || '' %>">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-900" for="emergencyContactPhone">Phone Number</label>
              <div class="mt-2">
                <input class="form-input" id="emergencyContactPhone" name="emergencyContactPhone" type="tel" value="<%= member.emergency_contact_phone || '' %>">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-900" for="emergencyContactEmail">Email Address</label>
              <div class="mt-2">
                <input class="form-input" id="emergencyContactEmail" name="emergencyContactEmail" type="email" value="<%= member.emergency_contact_email || '' %>">
              </div>
            </div>
          </div>
          <div class="flex gap-3 pt-4">
            <button type="submit" class="btn-primary">Save Changes</button>
            <button type="button" id="cancel-emergency-btn" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Capabilities -->
  <div class="card mb-6">
    <div class="card-body">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-xl font-bold text-gray-900">Capabilities & Equipment</h2>
        <button type="button" id="toggle-capabilities-btn" class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-indigo-600 hover:text-indigo-500">
          <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
          Edit
        </button>
      </div>
      
      <!-- View Mode -->
      <div id="capabilities-view">
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          <!-- Radio Equipment -->
          <div>
            <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2">
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.348 14.651a3.75 3.75 0 010-5.303m5.304 0a3.75 3.75 0 010 5.303m-7.425 2.122a6.75 6.75 0 010-9.546m9.546 0a6.75 6.75 0 010 9.546M5.106 18.894c-3.808-3.808-3.808-9.98 0-13.789m13.788 0c3.808 3.808 3.808 9.98 0 13.789" />
              </svg>
              Radio Equipment
            </h3>
            <div class="space-y-2">
              <div class="flex items-center gap-2 text-sm">
                <% if (member.hf_capable) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.hf_capable ? 'text-gray-900' : 'text-gray-500' %>">HF<% if (member.hf_power) { %> (<%= member.hf_power %>W)<% } %></span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.vhf_uhf_capable) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.vhf_uhf_capable ? 'text-gray-900' : 'text-gray-500' %>">VHF/UHF<% if (member.vhf_uhf_power) { %> (<%= member.vhf_uhf_power %>W)<% } %></span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.mobile_station) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.mobile_station ? 'text-gray-900' : 'text-gray-500' %>">Mobile Station</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.portable_station) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.portable_station ? 'text-gray-900' : 'text-gray-500' %>">Portable Station</span>
              </div>
              <% if (member.tower_antenna_height) { %>
                <div class="flex items-center gap-2 text-xs text-gray-600">
                  <svg class="h-4 w-4 text-indigo-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                  </svg>
                  <span>Tower/Antenna: <%= member.tower_antenna_height %> ft</span>
                </div>
              <% } %>
            </div>
          </div>

          <!-- Digital Modes -->
          <div>
            <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2">
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
              </svg>
              Digital Modes
            </h3>
            <div class="space-y-2">
              <div class="flex items-center gap-2 text-sm">
                <% if (member.winlink_capable) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.winlink_capable ? 'text-gray-900' : 'text-gray-500' %>">Winlink</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.aprs_capable) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.aprs_capable ? 'text-gray-900' : 'text-gray-500' %>">APRS</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.packet_radio) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.packet_radio ? 'text-gray-900' : 'text-gray-500' %>">Packet Radio</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.ft8_capable) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.ft8_capable ? 'text-gray-900' : 'text-gray-500' %>">FT8</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.js8call_capable) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.js8call_capable ? 'text-gray-900' : 'text-gray-500' %>">JS8Call</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.rtty_capable) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.rtty_capable ? 'text-gray-900' : 'text-gray-500' %>">RTTY</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.sstv_capable) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.sstv_capable ? 'text-gray-900' : 'text-gray-500' %>">SSTV</span>
              </div>
            </div>
          </div>

          <!-- Voice Modes -->
          <div>
            <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2">
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />
              </svg>
              Digital Voice
            </h3>
            <div class="space-y-2">
              <div class="flex items-center gap-2 text-sm">
                <% if (member.dstar_capable) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.dstar_capable ? 'text-gray-900' : 'text-gray-500' %>">D-STAR</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.dmr_capable) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.dmr_capable ? 'text-gray-900' : 'text-gray-500' %>">DMR</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.fusion_capable) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.fusion_capable ? 'text-gray-900' : 'text-gray-500' %>">Fusion (C4FM)</span>
              </div>
            </div>
          </div>

          <!-- Power & Infrastructure -->
          <div>
            <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2">
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
              Power & Infrastructure
            </h3>
            <div class="space-y-2">
              <div class="flex items-center gap-2 text-sm">
                <% if (member.emergency_power) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.emergency_power ? 'text-gray-900' : 'text-gray-500' %>">Emergency Power<% if (member.emergency_power_type) { %> (<%= member.emergency_power_type %>)<% } %></span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.backup_batteries) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.backup_batteries ? 'text-gray-900' : 'text-gray-500' %>">Backup Batteries</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.solar_power) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.solar_power ? 'text-gray-900' : 'text-gray-500' %>">Solar Power</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.satellite_internet) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.satellite_internet ? 'text-gray-900' : 'text-gray-500' %>">Satellite Internet<% if (member.satellite_internet_type) { %> (<%= member.satellite_internet_type %>)<% } %></span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.mesh_network) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.mesh_network ? 'text-gray-900' : 'text-gray-500' %>">Mesh Network</span>
              </div>

              <div class="flex items-center gap-2 text-sm">
                <% if (member.firstnet_device) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.firstnet_device ? 'text-gray-900' : 'text-gray-500' %>">FirstNet Capable</span>
              </div>
            </div>
          </div>

          <!-- Training & Certifications -->
          <div>
            <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2">
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
              </svg>
              Training & Certs
            </h3>
            <div class="space-y-2">
              <div class="flex items-center gap-2 text-sm">
                <% if (member.ares_races_trained) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.ares_races_trained ? 'text-gray-900' : 'text-gray-500' %>">ARES/RACES</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.skywarn_trained) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.skywarn_trained ? 'text-gray-900' : 'text-gray-500' %>">SKYWARN</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.incident_command_trained) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.incident_command_trained ? 'text-gray-900' : 'text-gray-500' %>">Incident Command (ICS)</span>
              </div>
              <div class="flex items-center gap-2 text-sm">
                <% if (member.cpr_first_aid_certified) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.cpr_first_aid_certified ? 'text-gray-900' : 'text-gray-500' %>">CPR/First Aid</span>
              </div>
            </div>
          </div>

          <!-- Emergency Readiness -->
          <div>
            <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center gap-2">
              <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
              Emergency Readiness
            </h3>
            <div class="space-y-2">
              <div class="flex items-center gap-2 text-sm">
                <% if (member.go_kit_ready) { %>
                  <svg class="h-4 w-4 text-green-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                <% } else { %>
                  <svg class="h-4 w-4 text-gray-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                  </svg>
                <% } %>
                <span class="<%= member.go_kit_ready ? 'text-gray-900' : 'text-gray-500' %>">Go-Kit Ready</span>
              </div>
            </div>
          </div>
        </div>

        <% if (member.capabilities_notes) { %>
          <div class="mt-6 pt-6 border-t border-gray-200">
            <h3 class="text-sm font-semibold text-gray-900 mb-2">Additional Notes</h3>
            <p class="text-sm text-gray-600 whitespace-pre-line"><%= member.capabilities_notes %></p>
          </div>
        <% } %>
      </div>

      <!-- Edit Mode -->
      <div id="capabilities-edit" class="hidden">
        <form method="POST" action="/admin/members/<%= member.id %>/update-capabilities" class="space-y-8">
          
          <!-- Radio Equipment Section -->
          <div>
            <h3 class="text-base font-semibold text-gray-900 mb-4 pb-2 border-b">Radio Equipment</h3>
            <div class="grid md:grid-cols-2 gap-6">
              <div class="space-y-3">
                <div class="relative flex items-start">
                  <div class="flex h-6 items-center">
                    <input id="hfCapable" name="hfCapable" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.hf_capable ? 'checked' : '' %>>
                  </div>
                  <div class="ml-3 text-sm leading-6">
                    <label for="hfCapable" class="font-medium text-gray-900">HF capable</label>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-900" for="hfPower">HF Power (Watts)</label>
                  <div class="mt-1">
                    <input class="form-input" id="hfPower" name="hfPower" type="number" min="0" placeholder="e.g., 100" value="<%= member.hf_power || '' %>">
                  </div>
                </div>
              </div>

              <div class="space-y-3">
                <div class="relative flex items-start">
                  <div class="flex h-6 items-center">
                    <input id="vhfUhfCapable" name="vhfUhfCapable" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.vhf_uhf_capable ? 'checked' : '' %>>
                  </div>
                  <div class="ml-3 text-sm leading-6">
                    <label for="vhfUhfCapable" class="font-medium text-gray-900">VHF/UHF capable (2M/70CM)</label>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-900" for="vhfUhfPower">VHF/UHF Power (Watts)</label>
                  <div class="mt-1">
                    <input class="form-input" id="vhfUhfPower" name="vhfUhfPower" type="number" min="0" placeholder="e.g., 50" value="<%= member.vhf_uhf_power || '' %>">
                  </div>
                </div>
              </div>

              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="mobileStation" name="mobileStation" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.mobile_station ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="mobileStation" class="font-medium text-gray-900">Mobile station</label>
                </div>
              </div>

              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="portableStation" name="portableStation" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.portable_station ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="portableStation" class="font-medium text-gray-900">Portable station</label>
                </div>
              </div>

              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-900" for="towerAntennaHeight">Tower/Antenna Height (feet)</label>
                <div class="mt-1">
                  <input class="form-input" id="towerAntennaHeight" name="towerAntennaHeight" type="number" min="0" placeholder="e.g., 50" value="<%= member.tower_antenna_height || '' %>">
                </div>
              </div>
            </div>
          </div>

          <!-- Digital Modes Section -->
          <div>
            <h3 class="text-base font-semibold text-gray-900 mb-4 pb-2 border-b">Digital Modes</h3>
            <div class="grid md:grid-cols-3 gap-4">
              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="winlinkCapable" name="winlinkCapable" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.winlink_capable ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="winlinkCapable" class="font-medium text-gray-900">Winlink</label>
                </div>
              </div>
              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="aprsCapable" name="aprsCapable" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.aprs_capable ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="aprsCapable" class="font-medium text-gray-900">APRS</label>
                </div>
              </div>
              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="packetRadio" name="packetRadio" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.packet_radio ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="packetRadio" class="font-medium text-gray-900">Packet Radio</label>
                </div>
              </div>
              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="ft8Capable" name="ft8Capable" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.ft8_capable ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="ft8Capable" class="font-medium text-gray-900">FT8</label>
                </div>
              </div>
              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="js8callCapable" name="js8callCapable" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.js8call_capable ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="js8callCapable" class="font-medium text-gray-900">JS8Call</label>
                </div>
              </div>
              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="rttyCapable" name="rttyCapable" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.rtty_capable ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="rttyCapable" class="font-medium text-gray-900">RTTY</label>
                </div>
              </div>
              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="sstvCapable" name="sstvCapable" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.sstv_capable ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="sstvCapable" class="font-medium text-gray-900">SSTV</label>
                </div>
              </div>
            </div>
          </div>

          <!-- Digital Voice Section -->
          <div>
            <h3 class="text-base font-semibold text-gray-900 mb-4 pb-2 border-b">Digital Voice</h3>
            <div class="grid md:grid-cols-3 gap-4">
              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="dstarCapable" name="dstarCapable" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.dstar_capable ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="dstarCapable" class="font-medium text-gray-900">D-STAR</label>
                </div>
              </div>
              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="dmrCapable" name="dmrCapable" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.dmr_capable ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="dmrCapable" class="font-medium text-gray-900">DMR</label>
                </div>
              </div>
              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="fusionCapable" name="fusionCapable" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.fusion_capable ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="fusionCapable" class="font-medium text-gray-900">Fusion (C4FM)</label>
                </div>
              </div>
            </div>
          </div>

          <!-- Power & Infrastructure Section -->
          <div>
            <h3 class="text-base font-semibold text-gray-900 mb-4 pb-2 border-b">Power & Infrastructure</h3>
            <div class="grid md:grid-cols-2 gap-6">
              <div class="space-y-3">
                <div class="relative flex items-start">
                  <div class="flex h-6 items-center">
                    <input id="emergencyPower" name="emergencyPower" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.emergency_power ? 'checked' : '' %>>
                  </div>
                  <div class="ml-3 text-sm leading-6">
                    <label for="emergencyPower" class="font-medium text-gray-900">Emergency power</label>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-900" for="emergencyPowerType">Type (e.g., Generator, Solar)</label>
                  <div class="mt-1">
                    <input class="form-input" id="emergencyPowerType" name="emergencyPowerType" type="text" value="<%= member.emergency_power_type || '' %>">
                  </div>
                </div>
              </div>

              <div class="space-y-3">
                <div class="relative flex items-start">
                  <div class="flex h-6 items-center">
                    <input id="backupBatteries" name="backupBatteries" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.backup_batteries ? 'checked' : '' %>>
                  </div>
                  <div class="ml-3 text-sm leading-6">
                    <label for="backupBatteries" class="font-medium text-gray-900">Backup batteries</label>
                  </div>
                </div>
                <div class="relative flex items-start">
                  <div class="flex h-6 items-center">
                    <input id="solarPower" name="solarPower" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.solar_power ? 'checked' : '' %>>
                  </div>
                  <div class="ml-3 text-sm leading-6">
                    <label for="solarPower" class="font-medium text-gray-900">Solar power</label>
                  </div>
                </div>
              </div>

              <div class="space-y-3">
                <div class="relative flex items-start">
                  <div class="flex h-6 items-center">
                    <input id="satelliteInternet" name="satelliteInternet" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.satellite_internet ? 'checked' : '' %>>
                  </div>
                  <div class="ml-3 text-sm leading-6">
                    <label for="satelliteInternet" class="font-medium text-gray-900">Satellite internet</label>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-900" for="satelliteInternetType">Type (e.g., Starlink, HughesNet)</label>
                  <div class="mt-1">
                    <input class="form-input" id="satelliteInternetType" name="satelliteInternetType" type="text" value="<%= member.satellite_internet_type || '' %>">
                  </div>
                </div>
              </div>

              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="meshNetwork" name="meshNetwork" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.mesh_network ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="meshNetwork" class="font-medium text-gray-900">Mesh network capable</label>
                </div>
              </div>

              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="firstnetDevice" name="firstnetDevice" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.firstnet_device ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="firstnetDevice" class="font-medium text-gray-900">FirstNet Capable</label>
                </div>
              </div>
            </div>
          </div>

          <!-- Training & Certifications Section -->
          <div>
            <h3 class="text-base font-semibold text-gray-900 mb-4 pb-2 border-b">Training & Certifications</h3>
            <div class="grid md:grid-cols-2 gap-4">
              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="aresRacesTrained" name="aresRacesTrained" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.ares_races_trained ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="aresRacesTrained" class="font-medium text-gray-900">ARES/RACES trained</label>
                </div>
              </div>
              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="skywarnTrained" name="skywarnTrained" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.skywarn_trained ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="skywarnTrained" class="font-medium text-gray-900">SKYWARN trained</label>
                </div>
              </div>
              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="incidentCommandTrained" name="incidentCommandTrained" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.incident_command_trained ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="incidentCommandTrained" class="font-medium text-gray-900">Incident Command System (ICS) trained</label>
                </div>
              </div>
              <div class="relative flex items-start">
                <div class="flex h-6 items-center">
                  <input id="cprFirstAidCertified" name="cprFirstAidCertified" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.cpr_first_aid_certified ? 'checked' : '' %>>
                </div>
                <div class="ml-3 text-sm leading-6">
                  <label for="cprFirstAidCertified" class="font-medium text-gray-900">CPR/First Aid certified</label>
                </div>
              </div>
            </div>
          </div>

          <!-- Emergency Readiness Section -->
          <div>
            <h3 class="text-base font-semibold text-gray-900 mb-4 pb-2 border-b">Emergency Readiness</h3>
            <div class="relative flex items-start">
              <div class="flex h-6 items-center">
                <input id="goKitReady" name="goKitReady" value="true" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600" <%= member.go_kit_ready ? 'checked' : '' %>>
              </div>
              <div class="ml-3 text-sm leading-6">
                <label for="goKitReady" class="font-medium text-gray-900">Go-Kit ready (portable emergency communications kit)</label>
              </div>
            </div>
          </div>

          <!-- Additional Notes -->
          <div>
            <label class="block text-sm font-medium text-gray-900" for="capabilitiesNotes">Additional Notes</label>
            <div class="mt-2">
              <textarea class="form-input" id="capabilitiesNotes" name="capabilitiesNotes" rows="4" placeholder="Any additional equipment, capabilities, or notes..."><%= member.capabilities_notes || '' %></textarea>
            </div>
          </div>

          <div class="flex gap-3 pt-4 border-t">
            <button type="submit" class="btn-primary">Save Changes</button>
            <button type="button" id="cancel-capabilities-btn" class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Certifications -->
  <div id="certifications" class="card mb-6">
    <div class="card-body">
      <h2 class="text-xl font-bold text-gray-900 mb-6">Certifications</h2>
      
      <% if (allCertifications && allCertifications.length > 0) { 
        // Create a map of member's certifications for easy lookup
        const memberCertMap = {};
        if (member.achievements) {
          member.achievements.forEach(cert => {
            memberCertMap[cert.id] = cert;
          });
        }
      %>
        <div class="space-y-3">
          <% allCertifications.forEach(cert => { 
            const memberCert = memberCertMap[cert.id];
            const hasIt = !!memberCert;
            const isGranted = hasIt && (memberCert.verified == 1 || memberCert.granted_at);
            const isPending = hasIt && !isGranted;
          %>
            <div class="border border-gray-200 rounded-lg p-4 <%= isGranted ? 'bg-green-50 border-green-200' : isPending ? 'bg-yellow-50 border-yellow-200' : '' %>">
              <div class="flex items-start justify-between">
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <h3 class="text-sm font-semibold text-gray-900"><%= cert.name %></h3>
                    
                    <% if (isGranted) { %>
                      <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">
                        <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Verified by <%= memberCert.verified_by_callsign || memberCert.granted_by_callsign || 'Admin' %> on <%= new Date(memberCert.verified_at || memberCert.granted_at).toLocaleDateString() %>
                      </span>
                    <% } else if (isPending) { %>
                      <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800">
                        <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Pending Admin Approval
                      </span>
                    <% } %>
                  </div>
                  
                  <p class="text-sm text-gray-600"><%= cert.description %></p>
                  
                  <% if (memberCert && memberCert.proof_file_path) { %>
                    <div class="mt-2">
                      <a href="<%= memberCert.proof_file_path %>" target="_blank" class="text-xs text-indigo-600 hover:text-indigo-500 inline-flex items-center gap-1">
                        <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
                        </svg>
                        View uploaded verification
                      </a>
                    </div>
                  <% } %>
                </div>
                
                <div class="ml-4 flex gap-2">
                  <% if (isPending) { %>
                    <!-- Approve button for pending certifications -->
                    <form method="POST" action="/admin/certifications/<%= member.id %>/<%= cert.id %>/verify" class="inline">
                      <button type="submit" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        <svg class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Approve
                      </button>
                    </form>
                  <% } else if (isGranted) { %>
                    <!-- Revoke button for granted certifications -->
                    <form method="POST" action="/admin/certifications/<%= member.id %>/<%= cert.id %>/revoke" class="inline">
                      <button type="submit" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <svg class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                        Revoke
                      </button>
                    </form>
                  <% } else { %>
                    <!-- Verify button if member doesn't have this certification at all -->
                    <form method="POST" action="/admin/certifications/<%= member.id %>/<%= cert.id %>/grant" class="inline">
                      <button type="submit" class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <svg class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Verify
                      </button>
                    </form>
                  <% } %>
                </div>
              </div>
            </div>
          <% }); %>
        </div>
      <% } else { %>
        <p class="text-sm text-gray-500 italic">No certifications configured in the system</p>
      <% } %>
    </div>
  </div>

  <!-- Tier Progress -->
  <div class="mb-6">
    <h2 class="text-2xl font-bold tracking-tight text-gray-900 mb-4">Tier Progress</h2>
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      <% member.tiers.forEach(tier => { %>
        <div class="card <%= tier.achieved ? 'ring-2 ring-green-500' : '' %>">
          <div class="card-body">
            <h3 class="text-base font-semibold text-gray-900"><%= tier.name %></h3>
            <p class="mt-1 text-sm text-gray-600">
              <%= tier.completed_tasks %> / <%= tier.total_tasks %> tasks completed
            </p>
            <% if (tier.achieved) { %>
              <div class="mt-4">
                <span class="badge badge-success">✓ Achieved</span>
              </div>
            <% } %>
          </div>
        </div>
      <% }); %>
    </div>
  </div>

  <!-- Tasks -->
  <div class="mb-6">
    <h2 class="text-2xl font-bold tracking-tight text-gray-900 mb-4">Tasks</h2>
    <% let currentTier = null; %>
    <% tasks.forEach(task => { %>
      <% if (currentTier !== task.tier_name) { %>
        <% currentTier = task.tier_name; %>
        <h3 class="text-xl font-bold text-gray-900 mt-6 mb-3 first:mt-0"><%= task.tier_name %></h3>
      <% } %>
      
      <div class="card mb-3">
        <div class="px-4 py-3">
          <div class="flex justify-between items-center gap-4">
            <div class="flex-1 min-w-0">
              <div class="flex items-start gap-2">
                <% if (task.verified) { %>
                  <span class="text-lg flex-shrink-0">✅</span>
                <% } else if (task.completed) { %>
                  <span class="text-lg flex-shrink-0">⏳</span>
                <% } else { %>
                  <span class="text-lg flex-shrink-0">⬜</span>
                <% } %>
                <div class="min-w-0 flex-1">
                  <h4 class="text-sm font-semibold text-gray-900"><%= task.name %></h4>
                  <p class="mt-0.5 text-sm text-gray-600"><%= task.description %></p>
                  <% if (task.notes) { %>
                    <p class="mt-1.5 text-xs text-gray-500">
                      <span class="font-medium">Notes:</span> <%= task.notes %>
                    </p>
                  <% } %>
                  <% if (task.verified) { %>
                    <p class="mt-1.5 text-xs text-green-600">
                      Verified on <%= new Date(task.verified_at).toLocaleDateString() %>
                    </p>
                  <% } %>
                </div>
              </div>
            </div>
            <div class="flex-shrink-0">
              <% if (task.verified) { %>
                <span class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">Verified</span>
              <% } else if (task.completed) { %>
                <form method="POST" action="/admin/members/<%= member.id %>/tasks/<%= task.id %>/verify">
                  <button type="submit" class="inline-flex items-center rounded-md bg-indigo-600 px-2.5 py-1.5 text-xs font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Verify</button>
                </form>
              <% } else { %>
                <span class="inline-flex items-center rounded-md bg-yellow-50 px-2 py-1 text-xs font-medium text-yellow-800 ring-1 ring-inset ring-yellow-600/20">Not Started</span>
              <% } %>
            </div>
          </div>
        </div>
      </div>
    <% }); %>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Contact info toggle
  const toggleBtn = document.getElementById('toggle-edit-btn');
  const cancelBtn = document.getElementById('cancel-edit-btn');
  const viewMode = document.getElementById('contact-view');
  const editMode = document.getElementById('contact-edit');

  toggleBtn.addEventListener('click', function() {
    viewMode.classList.add('hidden');
    editMode.classList.remove('hidden');
  });

  cancelBtn.addEventListener('click', function() {
    viewMode.classList.remove('hidden');
    editMode.classList.add('hidden');
  });

  // Capabilities toggle
  const toggleCapabilitiesBtn = document.getElementById('toggle-capabilities-btn');
  const cancelCapabilitiesBtn = document.getElementById('cancel-capabilities-btn');
  const capabilitiesView = document.getElementById('capabilities-view');
  const capabilitiesEdit = document.getElementById('capabilities-edit');

  toggleCapabilitiesBtn.addEventListener('click', function() {
    capabilitiesView.classList.add('hidden');
    capabilitiesEdit.classList.remove('hidden');
  });

  cancelCapabilitiesBtn.addEventListener('click', function() {
    capabilitiesView.classList.remove('hidden');
    capabilitiesEdit.classList.add('hidden');
  });

  // Emergency contact toggle
  const toggleEmergencyBtn = document.getElementById('toggle-emergency-btn');
  const cancelEmergencyBtn = document.getElementById('cancel-emergency-btn');
  const emergencyView = document.getElementById('emergency-view');
  const emergencyEdit = document.getElementById('emergency-edit');

  toggleEmergencyBtn.addEventListener('click', function() {
    emergencyView.classList.add('hidden');
    emergencyEdit.classList.remove('hidden');
  });

  cancelEmergencyBtn.addEventListener('click', function() {
    emergencyView.classList.remove('hidden');
    emergencyEdit.classList.add('hidden');
  });

  // Certification form submissions (AJAX to prevent page reload)
  document.querySelectorAll('#certifications form').forEach(form => {
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const button = this.querySelector('button[type="submit"]');
      const originalText = button.innerHTML;
      button.disabled = true;
      button.innerHTML = '<svg class="animate-spin h-3 w-3 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
      
      try {
        const response = await fetch(this.action, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'Accept': 'application/json'
          }
        });
        
        if (response.ok) {
          // Reload the page without scrolling
          window.location.reload();
        } else {
          alert('Error updating certification');
          button.disabled = false;
          button.innerHTML = originalText;
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Error updating certification');
        button.disabled = false;
        button.innerHTML = originalText;
      }
    });
  });
});

// Confirmation dialog for admin toggle
function confirmAdminToggle(name, isCurrentlyAdmin) {
  if (isCurrentlyAdmin) {
    return confirm(`Are you sure you want to remove admin access from ${name}?\n\nThis will revoke all administrative privileges.`);
  } else {
    return confirm(`Are you sure you want to grant admin access to ${name}?\n\nThis will give them full administrative privileges including the ability to manage other members.`);
  }
}
</script>


